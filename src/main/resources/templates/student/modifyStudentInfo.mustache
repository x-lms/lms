<!-- modifyStudentInfo.mustache -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í•™ìƒ ì •ë³´ ìˆ˜ì •</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/modifyStudent-info.css">
</head>
<body>
    {{ >layouts/header }}
    <div class="container">
        {{ >layouts/navStudent }}
        <div class="main-content">
            <div class="page-header">
                <h2 class="page-title">í•™ìƒ ì •ë³´ ìˆ˜ì •</h2>
                <p class="page-subtitle">ë‚´ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            </div>

            <div class="student-card">
                <div class="card-header">
                    <div class="profile-image-wrapper">
                        <img id="previewImg" 
                             src="{{#s.studentImg}}{{s.studentImg}}{{/s.studentImg}}{{^s.studentImg}}/images/default-profile.png{{/s.studentImg}}" 
                             alt="í•™ìƒ ì´ë¯¸ì§€" 
                             class="profile-image">
                    </div>
                    <h3 class="profile-name">{{s.studentName}}</h3>
                    <p class="profile-role">í•™ìƒ</p>
                </div>

                <div class="card-body">
                    <form id="studentForm" 
                          action="/student/modifyStudentInfo" 
                          method="post" 
                          enctype="multipart/form-data">
                        
                        <!-- studentNo ë°˜ë“œì‹œ hidden inputìœ¼ë¡œ í¬í•¨ -->
                        <input type="hidden" name="studentNo" value="{{s.studentNo}}">

                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">ì‚¬ì§„</div>
                                <input type="file" name="studentImgFile" id="studentImg">
                            </div>

                            <div class="info-item">
                                <div class="info-label">í•™ê³¼ ë²ˆí˜¸ *</div>
                                <input type="text" name="deptNo" value="{{s.deptNo}}" required>
                            </div>

                            <div class="info-item">
                                <div class="info-label">ë¹„ë°€ë²ˆí˜¸</div>
                                <input type="password" name="studentPw" id="password">
                                <span id="pwMessage" style="color:red;"></span>
                            </div>

                            <div class="info-item">
                                <div class="info-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</div>
                                <input type="password" name="studentPw2" id="password2">
                            </div>

                            <div class="info-item">
                                <div class="info-label">ì´ë¦„ *</div>
                                <input type="text" name="studentName" value="{{s.studentName}}" required>
                            </div>

                            <div class="info-item">
                                <div class="info-label">ìƒë…„ì›”ì¼ *</div>
                                <input type="date" name="studentBirth" value="{{s.studentBirth}}" required>
                            </div>

                            <div class="info-item">
                                <div class="info-label">ì „í™”ë²ˆí˜¸</div>
                                <input type="text" name="studentPhone" value="{{s.studentPhone}}">
                            </div>

                            <div class="info-item">
                                <div class="info-label">ì£¼ì†Œ</div>
                                <input type="text" name="studentAddress" value="{{s.studentAddress}}">
                            </div>

                            <div class="info-item">
                                <div class="info-label">ì´ë©”ì¼</div>
                                <input type="email" name="studentEmail" value="{{s.studentEmail}}">
                            </div>

                            <div class="info-item">
                                <button type="submit" class="btn-submit">ì €ì¥</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
    $('#studentImg').on('change', function() {
        const [file] = this.files;
        if (file) {
            $('#previewImg').attr('src', URL.createObjectURL(file));
        }
    });

    $(document).ready(function() {

        // ================================
        // ğŸ“Œ 1. ë¹„ë°€ë²ˆí˜¸ ì‹¤ì‹œê°„ ì…ë ¥ ì œí•œ
        // ================================
        $("#password").on("input", function() {
            const password = $(this).val();
            const regex = /^[A-Za-z0-9]*$/;

            if(regex.test(password)) {
                $("#pwMessage").text("");
            } else {
                $("#pwMessage").text("ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ìì™€ ì˜ì–´ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                $(this).val(password.replace(/[^A-Za-z0-9]/g, ""));
            }
        });



        // ================================
        // ğŸ“Œ 2. í•œêµ­ ì „í™”ë²ˆí˜¸ ë§ˆìŠ¤í‚¹(í•˜ì´í”ˆ ìë™)
        // ================================
        const $phone = $("input[name='studentPhone']");

        $phone.on("input", function() {
            let val = $(this).val().replace(/[^0-9]/g, "");

            // ì„œìš¸ ë²ˆí˜¸(02)
            if (val.startsWith("02")) {
                if (val.length > 2 && val.length <= 5) {
                    val = val.replace(/^(\d{2})(\d{1,3})/, "$1-$2");
                } else if (val.length > 5) {
                    val = val.replace(/^(\d{2})(\d{3,4})(\d{1,4})/, "$1-$2-$3");
                }
            } 
            // íœ´ëŒ€í° ë° ì¼ë°˜ ì§€ì—­ë²ˆí˜¸
            else {
                if (val.length > 3 && val.length <= 7) {
                    val = val.replace(/^(\d{3})(\d{1,3})/, "$1-$2");
                } else if (val.length > 7) {
                    val = val.replace(/^(\d{3})(\d{3,4})(\d{1,4})/, "$1-$2-$3");
                }
            }

            $(this).val(val);
        });



        // ================================
        // ğŸ“Œ 3. í¼ ì œì¶œ ì‹œ ìœ íš¨ì„± ê²€ì‚¬
        // ================================
        $("form").on("submit", function(e) {

            // ---- (1) ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ----
            const pw = $("#password").val();
            const pw2 = $("#password2").val();

            // ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ì…ë ¥í–ˆë‹¤ë©´ ê²€ì‚¬
            if (pw || pw2) {
                if (pw !== pw2) {
                    alert("ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    e.preventDefault();
                    return;
                }

                // ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸/ìˆ«ì ì¡°í•©ë§Œ í—ˆìš©
                const pwRegex = /^[A-Za-z0-9]+$/;
                if (!pwRegex.test(pw)) {
                    alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ì–´ì™€ ìˆ«ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                    e.preventDefault();
                    return;
                }
            }


            // ---- (2) ì „í™”ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ ----
            const phone = $phone.val();

            if (phone) {
                const phoneRegex = /^(01[0-9]-\d{3,4}-\d{4}|0[2-6][0-9]?-\d{3,4}-\d{4})$/;

                if (!phoneRegex.test(phone)) {
                    alert("ì˜¬ë°”ë¥¸ í•œêµ­ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\nì˜ˆ: 010-1234-5678");
                    e.preventDefault();
                    return;
                }
            }
        });
    });
</script>

</body>
</html>
