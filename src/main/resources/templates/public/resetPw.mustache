<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>비밀번호 변경 - 학습관리시스템</title>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<link rel="stylesheet" href="{{springMacroRequestContext.request.contextPath}}/css/common.css">
	<link rel="stylesheet" href="{{springMacroRequestContext.request.contextPath}}/css/stylejm.css">
</head>
<body class="login-wrapper">
	<header class="login-header">
		<div class="logo">LMS</div>
		<div>
			<h1>한국대학교 학습관리시스템</h1>
			<p>Hankuk University Learning Management System</p>
		</div>
	</header>

	<main class="login-content">
		<div class="login-container">
			<div class="login-title">
				<h2>비밀번호 변경</h2>
				<p>새로운 비밀번호를 입력해주세요</p>
			</div>

			<div class="login-body">
				<form id="resetPwForm">
					<div class="form-group">
						<label>새 비밀번호</label>
						<input type="password" name="newPw" id="newPw" class="form-input" placeholder="새 비밀번호를 입력하세요" required>
						<p class="help-text">8자 이상, 영문/숫자/특수문자 포함</p>
					</div>
					<div class="form-group">
						<label>비밀번호 확인</label>
						<input type="password" name="confirmPassword" id="confirmPassword" class="form-input" placeholder="비밀번호를 다시 입력하세요" required>
						<p class="help-text" id="pwMatch"></p>
					</div>
					<button type="button" id="btnResetPw" class="login-btn">비밀번호 변경</button>
				</form>
				<div class="extra-links">
					<a href="{{springMacroRequestContext.request.contextPath}}/login">로그인으로 돌아가기</a>
				</div>
			</div>
		</div>
	</main>

	<footer class="login-footer">
		<p>© 2024 한국대학교 정보전산원. All rights reserved.</p>
	</footer>
</body>

<script>
	// 비밀번호 일치 확인
	$('#confirmPassword').on('keyup', function() {
		const newPw = $('#newPw').val();
		const confirmPw = $(this).val();

		if (confirmPw === '') {
			$('#pwMatch').text('');
			return;
		}

		if (newPw === confirmPw) {
			$('#pwMatch').text('✓ 비밀번호가 일치합니다').css('color', '#22c55e');
		} else {
			$('#pwMatch').text('✗ 비밀번호가 일치하지 않습니다').css('color', '#ef4444');
		}
	});

	// 비밀번호 변경
	$('#btnResetPw').on('click', function() {
		const newPw = $('#newPw').val();
		const confirmPw = $('#confirmPassword').val();

		// 유효성 검사
		if (newPw.length < 8) {
			alert('비밀번호는 8자 이상이어야 합니다.');
			return;
		}

		if (newPw !== confirmPw) {
			alert('비밀번호가 일치하지 않습니다.');
			return;
		}

		const data = $('#resetPwForm').serialize();

		$.ajax({
			url : '{{springMacroRequestContext.request.contextPath}}/resetPw',
			method : 'POST',
			data : data,
			success : function(res) {
				if (res.success) {
					alert('비밀번호가 변경되었습니다.');
					location.href = '{{springMacroRequestContext.request.contextPath}}/login';
				} else {
					alert('비밀번호 변경에 실패했습니다.');
				}
			}
		});
	});
</script>
</html>