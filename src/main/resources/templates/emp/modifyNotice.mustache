<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìŠµê´€ë¦¬ì‹œìŠ¤í…œ - ê³µì§€ì‚¬í•­ ìˆ˜ì •</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/stylejm.css">
</head>
<body>
		<!-- include -->
		{{>layouts/header}}
	<div class="container">
		{{>layouts/navEmp}}
		<div class="main-content">
			<div class="page-header">
				<h2 class="page-title">ê³µì§€ì‚¬í•­ ìˆ˜ì •</h2>
			</div>

			<div class="notice-form-container">
				<form class="notice-form"
					action="{{springMacroRequestContext.request.contextPath}}/emp/modifyNotice?noticeNo={{noticeNo}}" method="post"
					enctype="multipart/form-data">
					{{#noticeOne}}
					<div class="form-row">
						<label class="form-label required">ì œëª©</label> <input type="text"
							name="noticeTitle" class="form-input" placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
							value="{{noticeTitle}}" required>
					</div>

					<div class="form-row">
						<label class="form-label required">ë‚´ìš©</label>
						<textarea name="noticeContents" class="form-textarea" rows="15"
							placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required>{{noticeContents}}</textarea>
					</div>
					{{/noticeOne}}
					<div class="form-row">
						<label class="form-label">ê¸°ì¡´ ì²¨ë¶€íŒŒì¼</label>
						<div class="existing-files">
							{{#fileList}}
								<div class="existing-file-item" data-fileno="{{fileNo}}">
									<div class="file-info">
										<span class="file-icon">ğŸ“</span>
										<span class="file-name">{{originName}}</span>
										<span class="file-size">({{fileSize}} KB)</span>
									</div>
									<button type="button" class="btn-file-delete">ì‚­ì œ</button>
								</div>
							{{/fileList}}
							{{^fileList}}
								<p class="file-undefined">ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
							{{/fileList}}
							<input type="hidden" name="deleteFileNos" id="deleteFileNos">
						</div>
					</div>

					<div class="form-row">
						<label class="form-label">ìƒˆ ì²¨ë¶€íŒŒì¼ ì¶”ê°€</label>
						<div class="file-upload-wrapper">
							<input type="file" name="attachments" id="fileInput" class="file-input" multiple>
							<label for="fileInput" class="file-label">
								<span class="file-icon">ğŸ“</span>
								<span class="file-text">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</span>
							</label>
							<div class="file-list"></div>
						</div>
					</div>

					<div class="form-actions">
						<a href="{{springMacroRequestContext.request.contextPath}}/public/noticeOne?noticeNo={{noticeNo}}" class="btn-secondary">ì·¨ì†Œ</a>
						<button type="submit" class="btn-primary">ìˆ˜ì • ì™„ë£Œ</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	{{>layouts/footer}}

	<script>
		// íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
		$('#fileInput').on('change', function(e) {
		const files = e.target.files;
		displayFiles(files);
		});
		
		// íŒŒì¼ ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
		function displayFiles(files) {
			const fileList = $('.file-list');
			fileList.empty();
			
			if(files.length > 0) {
				for(let i = 0; i < files.length; i++) {
				fileList.append(`
					<div class="file-item">
					<span class="file-name">${files[i].name}</span>
					<span class="file-size">(${(files[i].size / 1024).toFixed(2)} KB)</span>
					</div>
				`);
				}
			}
		}
		
		// ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
		const fileLabel = $('.file-label');
		
		fileLabel.on('dragover', function(e) {
			e.preventDefault();
			e.stopPropagation();
			$(this).addClass('drag-over');
		});
		
		fileLabel.on('dragleave', function(e) {
			e.preventDefault();
			e.stopPropagation();
			$(this).removeClass('drag-over');
		});
		
		fileLabel.on('drop', function(e) {
			e.preventDefault();
			e.stopPropagation();
			$(this).removeClass('drag-over');
			
			const files = e.originalEvent.dataTransfer.files;
			$('#fileInput')[0].files = files;
			displayFiles(files);
		});
		
		let deleteList = [];
		$('.btn-file-delete').on('click', function() {
			if(!confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
			
			const item = $(this).closest('.existing-file-item');
			const fileNo = item.data('fileno');
			deleteList.push(fileNo);
			
			console.log(deleteList);
			item.hide();
		});
		
		$('.notice-form').on('submit', function () {
			$('#deleteFileNos').val(deleteList.join(','));
		});
	</script>
</body>
</html>